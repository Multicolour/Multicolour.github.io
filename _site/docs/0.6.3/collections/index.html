<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Multicolour documentation collections</title>

  <!-- Base -->
<meta name="identifier-url" content="site.url" />
<meta name="title" content="Multicolour documentation collections" />
<meta name="description" content="Documentation on how to create and use Multicolour collections, blueprints and the Endpoint class to define the database structure for your rest api and how to handle database migrations." />
<meta name="abstract" content="Collections" />
<meta name="keywords" content="waterline blueprints, multicolour collection, database, table, define, migration" />
<meta name="author" content="New World Code Ltd" />
<meta name="revisit-after" content="7" />
<meta name="language" content="en" />
<meta name="copyright" content="© 2017 New World Code Ltd" />
<meta name="robots" content="Index" />


<!-- Social -->
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@getmulticolour">
<meta name="twitter:title" content="Multicolour documentation collections">
<meta name="twitter:description" content="Documentation on how to create and use Multicolour collections, blueprints and the Endpoint class to define the database structure for your rest api and how ...">
<meta name="twitter:creator" content="@getmulticolour">
<meta name="twitter:image" content="http://0.0.0.0:4000/images/MC_Icon_PurpleRain_Logotype.png">

<meta itemprop="name" content="Multicolour documentation collections">
<meta itemprop="description" content="Documentation on how to create and use Multicolour collections, blueprints and the Endpoint class to define the database structure for your rest api and how ...">
<meta itemprop="image" content="http://0.0.0.0:4000/images/MC_Icon_PurpleRain_Logotype.png">

<meta property="og:title" content="Multicolour documentation collections" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://0.0.0.0:4000" />
<meta property="og:image" content="http://0.0.0.0:4000/images/MC_Icon_PurpleRain_Logotype.png" />
<meta property="og:description" content="Documentation on how to create and use Multicolour collections, blueprints and the Endpoint class to define the database structure for your rest api and how ..." />
<meta property="og:site_name" content="Multicolour documentation collections" />

<link rel="icon" href="/images/iconography/favicon.ico">
<link rel="apple-touch-icon" sizes="57x57" href="/images/iconography/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/images/iconography/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/images/iconography/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/images/iconography/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/images/iconography/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/images/iconography/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/images/iconography/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/images/iconography/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/iconography/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="/images/iconography/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/images/iconography/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/images/iconography/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/images/iconography/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<meta name="msapplication-TileColor" content="#FF9999">
<meta name="msapplication-TileImage" content="/images/iconography/ms-icon-144x144.png">
<meta name="theme-color" content="#FF9999">



  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,300" rel="stylesheet" type="text/css" async>
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://0.0.0.0:4000/docs/0.6.3/collections/">
  <link rel="alternate" type="application/rss+xml" title="Multicolour - Rest API generator" href="http://0.0.0.0:4000/feed.xml">
</head>


<body>
    <main class="docs">
      <div class="general-nav">
    <nav>
        <a href="/" class="logo-link no-border" title="Multicolour - Rest API generator">
            <img class="nav-logo" src="/images/logo-stamp.svg" alt="Multicolour - Rest API generator">
        </a>

        <ul class="menu">
            <li>
                <a href="/examples/" title="Multicolour rest api generator examples">examples</a>
            </li>
            <li>
                <a href="/docs/0.6.3/" title="Multicolour docs">docs</a>
            </li>
            <li>
                <a href="/blog/" title="Multicolour blog">blog</a>
            </li>
        </ul>
    </nav>

    <menu class="breadcrumb-menu">
        <h1>Multicolour documentation collections</h1>

        <div class="breadcrumbs">
  <a class="breadcrumbs-logo" href="/" title="Multicolour - Rest API generator">
    <img src="/images/iconography/android-icon-36x36.png" alt="Multicolour - Rest API generator">
  </a>

  <span class="arrow">&rarr;</span>

  
  
  <a href="/docs/" title="docs">
    docs
  </a>

  <span class="arrow">&rarr;</span>
  
  <a href="/docs/0.6.3/" title="0.6.3">
    0.6.3
  </a>

  <span class="arrow">&rarr;</span>
  
  

  <a class="current" href="/docs/0.6.3/collections/" title="Multicolour documentation collections">
    
    Collections/Blueprints
    
  </a>
</div>

    </menu>
</div>


      <section class="columns">
        <aside>
            
            <h2 class="title">Docs <span>0.6.3</span></h2>
            
            <section class="search">
                <input type="search" name="search" placeholder="search the docs">
            </section>

            
            

<script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "APIReference",
        "headline": "Multicolour documentation collections",
        "assemblyVersion": "0.6.3",
        "executableLibraryName": "multicolour",
        "targetPlatform": "NodeJS",
        "keywords": "waterline blueprints, multicolour collection, database, table, define, migration",
        "learningResourceType": ["learning activity"],
        "wordCount": "1157",
        "datePublished": "2017-03-20 17:39:56 +0000",
        "url": "/docs/0.6.3/collections/",
        "publisher": {
            "@type": "Organization",
            "name": "Multicolour",
            "sameAs": [
                "https://twitter.com/getmulticolour",
                "https://github.com/Multicolour"
            ],
            "logo": {
                "@type": "ImageObject",
                "contentUrl": "http://0.0.0.0:4000/images/logo.png",
                "url": "http://0.0.0.0:4000"
            }
        },
        "image":{
            "@type":"ImageObject",
            "contentUrl":"http://0.0.0.0:4000/images/social-header.jpg",
            "url":"http://0.0.0.0:4000",
            "height":"500",
            "width":"1500"
         },
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http://0.0.0.0:4000/docs/0.6.3/collections/"
        },
        "articleBody": "CollectionsMulticolour collections are built on the popular Waterline ORM, this allowed us to minimise the amount of work that you do to get something you’d spend weeks or months doing.Multicolour expands on Blueprints slightly to give you some extra behavioural and timesaving tweaks as well as extra behaviour for Multicolour.A simple, example Multicolour blueprint might look something like this.&quot;use strict&quot;module.exports = {  attributes: {    slug: &quot;string&quot;,    title: {      type: &quot;string&quot;,      required: true,      index: true    },    description: {      type: &quot;string&quot;,      required: true    },    public: {      type: &quot;boolean&quot;,      defaultsTo: true,      metadata: {        description: &quot;Some projects are private, this flag is the decider.&quot;      }    },    // Associations.    user: {      model: &quot;user&quot;    }  },  constraints: {    get: {      user: &quot;auth.credentials.user.id&quot;,      public: { compile: false, value: true }    },  }}A few things are happening above, we’re exporting an Object with a few keys. The first key is attributes, this is where you define the properties/columns/keys in your table/document.Each key of the attributes can be an object of properties or simply the type that key should be. Valid types are:  &quot;string&quot;  &quot;text&quot;  &quot;email&quot;  &quot;integer&quot;  &quot;float&quot;  &quot;date&quot;  &quot;time&quot;  &quot;datetime&quot;  &quot;boolean&quot;  &quot;binary&quot;  &quot;array&quot;  &quot;json&quot;Properties can also have a metadata key, this is where you can add descriptive and informative notes that will appear in the documentation generated by your chosen server framework.There is also a constraints key outside of the attributes, this serves as a simple “logic free” way to constrain actions on the database.If you were to write the JavaScript for that constraint, it might look something like this.projects.findOne(request.payload, (err, project) =&amp;gt; {  if (row.user.toString() !== request.auth.credentials.user.id.toString()    || row.public === false) {    reply(&quot;You aren't allowed to do this.&quot;).code(412)  }  else {    reply(project)  }})...A value computed by a constraint will always overwrite any value sent to the server intended for a write request to the database.Naming and identityTo be as predictable as possible, Multicolour takes the name of your blueprint.js and makes sure it is not pluralised in any way. If you have a blueprint named projects.js in your blueprints folder, Multicolour will name your collection project and your routes will all be /project/.Lifecycle callbacksIf constraints aren’t for you, you can use lifecycle callbacks to prevent/check writes and reads from your database.Each model has the following available callbacks.  beforeValidate(values, next)  afterValidate(values, next)  beforeCreate(values, next)  afterCreatefn(newlyInsertedRecord, next)  beforeUpdate(valuesToUpdate, next)  afterUpdate(updatedRecord, next)  beforeDestroy(criteria, next)  afterDestroy(deletedRecord, next)To read more on lifecycle callbacks, read the Waterline lifecycle documentation.AssociationsYour blueprints can have associations to other blueprints (even across database technologies) which are automatically populated by Multicolour. Your associations can be one-to-one, one-to-many or many-to-many.You make associations in your blueprint by specifying the property that should be associated and either a model or collection property within with an optional via value.Example:...attributes: {  // One-to-one  user: {    model: &quot;user&quot;  },  // One-to-many  projects: {    collection: &quot;project&quot;,    via: &quot;user&quot;  }}...Adding associations programatically.There may be a time you need to add a relationship to another collection without modifying the blueprint. The add_relation_to_collection(as, target_collection, related_collection, many) function will do this for you.This function will add a relationship, either one to one or one to many to your collection.It will not overwrite any relationship by the same nameIt will throw if either collection does not exist.Passing true to many will make the relationship one to many.ExampleAdding a team relationship to the multicolour_user collection.// app.jsmy_service.get(&quot;database&quot;)  .add_relation_to_collection(&quot;team&quot;, &quot;multicolour_user&quot;, &quot;team&quot;)  .add_relation_to_collection(&quot;users&quot;, &quot;team&quot;, &quot;multicolour_user&quot;)A sugar function that does the same in a more terse way is the .join method.my_service.get(&quot;database&quot;)  .join({    as: &quot;team&quot;,    from: &quot;multicolour_user&quot;,    to: &quot;team&quot;  })  .join({    as: &quot;team&quot;,    from: &quot;team&quot;,    to: &quot;multicolour_user&quot;  })You can find more about how Waterline handles associations by reading the documentationtoJSONEvery model has a toJSON method, even if you don’t supply one, Multicolour adds one for you which simply removes any null or undefined keys before conitnueing with the reply.If you supply a toJSON method, Multicolour wraps your toJSON in the default so behaviour stays predictable.Example removing a password and salt from a reply:attributes: {  // Your model...  toJSON: function() {    const model = this.toObject()    delete model.password    delete model.salt    return model  }}FlagsThere are flags available to change Multicolour behaviour on your models, they are:  NO_AUTO_GEN_ROUTES: Boolean This tells Multicolour whether or not to generate CRUD endpoints for this model. custom_routes are still honoured.  NO_AUTO_GEN_FRONTEND: Boolean This tells Multicolour whether or not to generate a frontend (if you have enabled a frontend plugin).During the generation Multicolour also adds a new property to each model, multicolour_instance which is the current instance of Multicolour from which you can access your entire app."
    }
</script>


            <ul class="search-results">
  
  
    <li
      data-keywords="multicolour API, API reference"
      
      class="visible">
      <a href="/docs/0.6.3/api-reference/" title="Multicolour core API reference">
        API Reference
      </a>
      

      
    </li>
  
    <li
      data-keywords="multicolour, cli"
      
      class="visible">
      <a href="/docs/0.6.3/cli/" title="Multicolour documentation CLI">
        CLI
      </a>
      

      
    </li>
  
    <li
      data-keywords="waterline blueprints, multicolour collection, database, table, define, migration"
      
      class="active visible">
        Collections/Blueprints
      

      
    </li>
  
    <li
      data-keywords="multicolour config, server configuration, rest api config"
      
      class="visible">
      <a href="/docs/0.6.3/configuration/" title="Multicolour documentation configuration">
        Configuration
      </a>
      

      
    </li>
  
    <li
      data-keywords="codeless business logic, multicolour constraints"
      
      class="visible">
      <a href="/docs/0.6.3/collections/constraints/" title="Multicolour documentation constraints">
        Constraints
      </a>
      

      
    </li>
  
    <li
      data-keywords="database, migration, data, existing database, automatic"
      
      class="visible">
      <a href="/docs/0.6.3/collections/migration/" title="Multicolour documentation database migration">
        Migration
      </a>
      

      
    </li>
  
    <li
      data-keywords="multicolour, rest api, debugging"
      
      class="visible">
      <a href="/docs/0.6.3/debugging/" title="Multicolour documentation debugging tips">
        Debugging
      </a>
      

      
    </li>
  
    <li
      data-keywords=""
      
      class="visible">
      <a href="/docs/0.6.3/quickstart/" title="Multicolour quickstart">
        Quickstart
      </a>
      

      
    </li>
  
    <li
      data-keywords="multicolour, rest api, verbs, handlers"
      
      class="visible">
      <a href="/docs/0.6.3/handlers/" title="Multicolour REST API method handlers documentation.">
        Handlers
      </a>
      

      
    </li>
  
    <li
      data-keywords="multicolour, javascript sdk"
      
      class="visible">
      <a href="/docs/0.6.3/javascript-sdk/" title="Multicolour documentation JavaScript SDK generator">
        JavaScript SDK
      </a>
      

      
    </li>
  
    <li
      data-keywords="multicolour, plugins, rest api business logic"
      
      class="visible">
      <a href="/docs/0.6.3/plugins/" title="Multicolour documentation plugins">
        Writing plugins
      </a>
      

      
    </li>
  
    <li
      data-keywords="multicolour, REST API routes, routing"
      
      class="visible">
      <a href="/docs/0.6.3/routing/" title="Multicolour documentation routing">
        Routing
      </a>
      

      
    </li>
  
    <li
      data-keywords="rest api query, results filtering, searching"
      
      class="visible">
      <a href="/docs/0.6.3/routing/results/" title="Multicolour documentation result filtering">
        Results Filtering
      </a>
      

      
    </li>
  
    <li
      data-keywords="multicolour, server, http"
      
      class="visible">
      <a href="/docs/0.6.3/server/" title="Multicolour server docs">
        Server
      </a>
      

      
    </li>
  
    <li
      data-keywords="file uploads, multicolour, rest api file uploads"
      
      class="visible">
      <a href="/docs/0.6.3/routing/file-uploads/" title="Multicolour documentation file uploads">
        Uploading files
      </a>
      

      
    </li>
  
</ul>

            
        </aside>
        <article>
          <h1 id="collections">Collections</h1>

<p>Multicolour collections are built on the popular <a href="https://github.com/balderdashy/waterline">Waterline ORM</a>, this allowed us to minimise the amount of work that you do to get something you’d spend weeks or months doing.</p>

<p>Multicolour expands on Blueprints slightly to give you some extra behavioural and timesaving tweaks as well as extra behaviour for Multicolour.</p>

<p>A simple, example Multicolour blueprint might look something like this.</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="s2">"use strict"</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">attributes</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">slug</span><span class="p">:</span> <span class="s2">"string"</span><span class="p">,</span>

    <span class="na">title</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">type</span><span class="p">:</span> <span class="s2">"string"</span><span class="p">,</span>
      <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="na">index</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>

    <span class="na">description</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">type</span><span class="p">:</span> <span class="s2">"string"</span><span class="p">,</span>
      <span class="na">required</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>

    <span class="na">public</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">type</span><span class="p">:</span> <span class="s2">"boolean"</span><span class="p">,</span>
      <span class="na">defaultsTo</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="na">metadata</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">description</span><span class="p">:</span> <span class="s2">"Some projects are private, this flag is the decider."</span>
      <span class="p">}</span>
    <span class="p">},</span>

    <span class="c1">// Associations.</span>
    <span class="na">user</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">model</span><span class="p">:</span> <span class="s2">"user"</span>
    <span class="p">}</span>
  <span class="p">},</span>

  <span class="na">constraints</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">get</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">user</span><span class="p">:</span> <span class="s2">"auth.credentials.user.id"</span><span class="p">,</span>
      <span class="na">public</span><span class="p">:</span> <span class="p">{</span> <span class="na">compile</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}</span>
    <span class="p">},</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>A few things are happening above, we’re exporting an Object with a few keys. The first key is <code class="highlighter-rouge">attributes</code>, this is where you define the properties/columns/keys in your table/document.</p>

<p>Each key of the <code class="highlighter-rouge">attributes</code> can be an object of properties or simply the type that key should be. Valid types are:</p>

<ul>
  <li><code class="highlighter-rouge">"string"</code></li>
  <li><code class="highlighter-rouge">"text"</code></li>
  <li><code class="highlighter-rouge">"email"</code></li>
  <li><code class="highlighter-rouge">"integer"</code></li>
  <li><code class="highlighter-rouge">"float"</code></li>
  <li><code class="highlighter-rouge">"date"</code></li>
  <li><code class="highlighter-rouge">"time"</code></li>
  <li><code class="highlighter-rouge">"datetime"</code></li>
  <li><code class="highlighter-rouge">"boolean"</code></li>
  <li><code class="highlighter-rouge">"binary"</code></li>
  <li><code class="highlighter-rouge">"array"</code></li>
  <li><code class="highlighter-rouge">"json"</code></li>
</ul>

<p>Properties can also have a <code class="highlighter-rouge">metadata</code> key, this is where you can add descriptive and informative notes that will appear in the documentation generated by your chosen server framework.</p>

<p>There is also a <code class="highlighter-rouge">constraints</code> key outside of the <code class="highlighter-rouge">attributes</code>, this serves as a simple “logic free” way to constrain actions on the database.</p>

<p>If you were to write the JavaScript for that constraint, it might look something like this.</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">projects</span><span class="p">.</span><span class="nx">findOne</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">payload</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">project</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">row</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">!==</span> <span class="nx">request</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">credentials</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="o">||</span> <span class="nx">row</span><span class="p">.</span><span class="kr">public</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">reply</span><span class="p">(</span><span class="s2">"You aren't allowed to do this."</span><span class="p">).</span><span class="nx">code</span><span class="p">(</span><span class="mi">412</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="nx">reply</span><span class="p">(</span><span class="nx">project</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">})</span>
<span class="p">...</span>
</code></pre>
</div>

<p>A value computed by a constraint will <strong><em>always</em></strong> overwrite any value sent to the server intended for a write request to the database.</p>

<h2 id="naming-and-identity">Naming and identity</h2>

<p>To be as predictable as possible, Multicolour takes the name of your <code class="highlighter-rouge">blueprint.js</code> and makes sure it is not pluralised in any way. If you have a blueprint named <code class="highlighter-rouge">projects.js</code> in your <code class="highlighter-rouge">blueprints</code> folder, Multicolour will name your collection <code class="highlighter-rouge">project</code> and your routes will all be <code class="highlighter-rouge">/project/</code>.</p>

<h2 id="lifecycle-callbacks">Lifecycle callbacks</h2>

<p>If constraints aren’t for you, you can use lifecycle callbacks to prevent/check writes and reads from your database.</p>

<p>Each model has the following available callbacks.</p>

<ul>
  <li><code class="highlighter-rouge">beforeValidate(values, next)</code></li>
  <li><code class="highlighter-rouge">afterValidate(values, next)</code></li>
  <li><code class="highlighter-rouge">beforeCreate(values, next)</code></li>
  <li><code class="highlighter-rouge">afterCreatefn(newlyInsertedRecord, next)</code></li>
  <li><code class="highlighter-rouge">beforeUpdate(valuesToUpdate, next)</code></li>
  <li><code class="highlighter-rouge">afterUpdate(updatedRecord, next)</code></li>
  <li><code class="highlighter-rouge">beforeDestroy(criteria, next)</code></li>
  <li><code class="highlighter-rouge">afterDestroy(deletedRecord, next)</code></li>
</ul>

<p>To read more on lifecycle callbacks, read the <a href="https://github.com/balderdashy/waterline-docs/blob/master/models/lifecycle-callbacks.md">Waterline lifecycle documentation</a>.</p>

<h2 id="associations">Associations</h2>
<p>Your blueprints can have associations to other blueprints (even across database technologies) which are automatically populated by Multicolour. Your associations can be <code class="highlighter-rouge">one-to-one</code>, <code class="highlighter-rouge">one-to-many</code> or <code class="highlighter-rouge">many-to-many</code>.</p>

<p>You make associations in your blueprint by specifying the property that should be associated and either a <code class="highlighter-rouge">model</code> or <code class="highlighter-rouge">collection</code> property within with an optional <code class="highlighter-rouge">via</code> value.</p>

<p>Example:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="p">...</span>
<span class="nl">attributes</span><span class="p">:</span> <span class="p">{</span>
  <span class="c1">// One-to-one</span>
  <span class="nl">user</span><span class="p">:</span> <span class="p">{</span>
    <span class="nl">model</span><span class="p">:</span> <span class="s2">"user"</span>
  <span class="p">},</span>

  <span class="c1">// One-to-many</span>
  <span class="nx">projects</span><span class="err">:</span> <span class="p">{</span>
    <span class="nl">collection</span><span class="p">:</span> <span class="s2">"project"</span><span class="p">,</span>
    <span class="nx">via</span><span class="err">:</span> <span class="s2">"user"</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">...</span>
</code></pre>
</div>

<h3 id="adding-associations-programatically">Adding associations programatically.</h3>

<p>There may be a time you need to add a relationship to another collection without modifying the blueprint. The <code class="highlighter-rouge">add_relation_to_collection(as, target_collection, related_collection, many)</code> function will do this for you.</p>

<p>This function will add a relationship, either one to one or one to many to your collection.
It will <em>not</em> overwrite any relationship by the same name
It will throw if either collection does not exist.
Passing true to <code class="highlighter-rouge">many</code> will make the relationship one to many.</p>

<p><em>Example</em></p>

<p>Adding a team relationship to the <code class="highlighter-rouge">multicolour_user</code> collection.</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="c1">// app.js</span>
<span class="nx">my_service</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">"database"</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">add_relation_to_collection</span><span class="p">(</span><span class="s2">"team"</span><span class="p">,</span> <span class="s2">"multicolour_user"</span><span class="p">,</span> <span class="s2">"team"</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">add_relation_to_collection</span><span class="p">(</span><span class="s2">"users"</span><span class="p">,</span> <span class="s2">"team"</span><span class="p">,</span> <span class="s2">"multicolour_user"</span><span class="p">)</span>
</code></pre>
</div>

<p>A sugar function that does the same in a more terse way is the <code class="highlighter-rouge">.join</code> method.</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">my_service</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">"database"</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">join</span><span class="p">({</span>
    <span class="na">as</span><span class="p">:</span> <span class="s2">"team"</span><span class="p">,</span>
    <span class="na">from</span><span class="p">:</span> <span class="s2">"multicolour_user"</span><span class="p">,</span>
    <span class="na">to</span><span class="p">:</span> <span class="s2">"team"</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">join</span><span class="p">({</span>
    <span class="na">as</span><span class="p">:</span> <span class="s2">"team"</span><span class="p">,</span>
    <span class="na">from</span><span class="p">:</span> <span class="s2">"team"</span><span class="p">,</span>
    <span class="na">to</span><span class="p">:</span> <span class="s2">"multicolour_user"</span>
  <span class="p">})</span>
</code></pre>
</div>

<p>You can find more about how Waterline handles associations by <a href="https://github.com/balderdashy/waterline-docs/tree/master/models/associations">reading the documentation</a></p>

<h2 id="tojson"><code class="highlighter-rouge">toJSON</code></h2>
<p>Every model has a <code class="highlighter-rouge">toJSON</code> method, even if you don’t supply one, Multicolour adds one for you which simply removes any <code class="highlighter-rouge">null</code> or <code class="highlighter-rouge">undefined</code> keys before conitnueing with the reply.</p>

<p>If you supply a <code class="highlighter-rouge">toJSON</code> method, Multicolour wraps your <code class="highlighter-rouge">toJSON</code> in the default so behaviour stays predictable.</p>

<p>Example removing a password and salt from a reply:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">attributes</span><span class="err">:</span> <span class="p">{</span>
  <span class="c1">// Your model...</span>

  <span class="nl">toJSON</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">model</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">toObject</span><span class="p">()</span>
    <span class="k">delete</span> <span class="nx">model</span><span class="p">.</span><span class="nx">password</span>
    <span class="k">delete</span> <span class="nx">model</span><span class="p">.</span><span class="nx">salt</span>
    <span class="k">return</span> <span class="nx">model</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<h2 id="flags">Flags</h2>

<p>There are flags available to change Multicolour behaviour on your models, they are:</p>

<ul>
  <li><code class="highlighter-rouge">NO_AUTO_GEN_ROUTES: Boolean</code> This tells Multicolour whether or not to generate CRUD endpoints for this model. <code class="highlighter-rouge">custom_routes</code> are still honoured.</li>
  <li><code class="highlighter-rouge">NO_AUTO_GEN_FRONTEND: Boolean</code> This tells Multicolour whether or not to generate a frontend (if you have enabled a frontend plugin).</li>
</ul>

<p>During the generation Multicolour also adds a new property to each model, <code class="highlighter-rouge">multicolour_instance</code> which is the current instance of Multicolour from which you can access your entire app.</p>


        </article>
      </section>
    </main>

    <footer class="site-footer">

  <ul>
    <li>
      <a href="/code-of-conduct" title="Multicolour code of conduct">
        Code of Conduct
      </a>
    </li>
    <li>
      <a href="/Multicolour_Branding_Guidelines_2016.pdf" target="_blank" rel="nofollow noopener noreferrer">
        Branding guidelines
      </a>
    </li>
    <li>
      <a href="https://github.com/Multicolour" target="_blank" rel="nofollow noopener noreferrer">
        Github Organisation
      </a>
    </li>
  </ul>
  <p>&copy; All copyright to Get Multicolour &amp; New World Code Ltd 2017</p>
</footer>

<script src="/js/main.js" async defer></script>
<script>
  !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.1.0";
    analytics.load("Qurt0kpTtzocuF8h8VgRH6ygztdQPK5i");
    analytics.page()
  }}();
</script>


</body>

</html>
